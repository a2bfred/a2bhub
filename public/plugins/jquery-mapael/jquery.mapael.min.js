!function(t){"object"==typeof exports?module.exports=t(require("jquery"),require("raphael"),require("jquery-mousewheel")):"function"==typeof define&&define.amd?define(["jquery","raphael","mousewheel"],t):t(jQuery,Raphael,jQuery.fn.mousewheel)}(function(t,e,o,a){"use strict";var i=function(e,o){this.container=e,this.$container=t(e),this.options=this.extendDefaultOptions(o),this.zoomTO=0,this.zoomCenterX=0,this.zoomCenterY=0,this.previousPinchDist=0,this.zoomData={zoomLevel:0,zoomX:0,zoomY:0,panX:0,panY:0},this.currentViewBox={x:0,y:0,w:0,h:0},this.panning=!1,this.zoomAnimID=null,this.zoomAnimStartTime=null,this.zoomAnimCVBTarget=null,this.$map=t("."+this.options.map.cssClass,this.container),this.initialMapHTMLContent=this.$map.html(),this.$tooltip={},this.paper={},this.areas={},this.plots={},this.links={},this.legends={},this.mapConf={},this.customEventHandlers={},this.init()};return i.prototype={MouseOverFilteringTO:120,panningFilteringTO:150,panningEndFilteringTO:50,zoomFilteringTO:150,resizeFilteringTO:150,init:function(){var o=this;if(""===o.options.map.cssClass||0===t("."+o.options.map.cssClass,o.container).length)throw new Error("The map class `"+o.options.map.cssClass+"` doesn't exists");if(o.$tooltip=t("<div>").addClass(o.options.map.tooltip.cssClass).css("display","none"),o.$map.empty().append(o.$tooltip),t.mapael&&t.mapael.maps&&t.mapael.maps[o.options.map.name])o.mapConf=t.mapael.maps[o.options.map.name];else{if(!(t.fn.mapael&&t.fn.mapael.maps&&t.fn.mapael.maps[o.options.map.name]))throw new Error("Unknown map '"+o.options.map.name+"'");o.mapConf=t.fn.mapael.maps[o.options.map.name],window.console&&window.console.warn&&window.console.warn("Extending $.fn.mapael is deprecated (map '"+o.options.map.name+"')")}if(o.paper=new e(o.$map[0],o.mapConf.width,o.mapConf.height),!0===o.isRaphaelBBoxBugPresent())throw o.destroy(),new Error("Can't get boundary box for text (is your container hidden? See #135)");o.$container.addClass("mapael"),o.options.map.tooltip.css&&o.$tooltip.css(o.options.map.tooltip.css),o.setViewBox(0,0,o.mapConf.width,o.mapConf.height),o.options.map.width?o.paper.setSize(o.options.map.width,o.mapConf.height*(o.options.map.width/o.mapConf.width)):o.initResponsiveSize(),t.each(o.mapConf.elems,function(t){o.areas[t]={},o.areas[t].options=o.getElemOptions(o.options.map.defaultArea,o.options.areas[t]?o.options.areas[t]:{},o.options.legend.area),o.areas[t].mapElem=o.paper.path(o.mapConf.elems[t])}),o.options.map.beforeInit&&o.options.map.beforeInit(o.$container,o.paper,o.options),t.each(o.mapConf.elems,function(t){o.initElem(t,"area",o.areas[t])}),o.links=o.drawLinksCollection(o.options.links),t.each(o.options.plots,function(t){o.plots[t]=o.drawPlot(t)}),o.$container.on("zoom.mapael",function(t,e){o.onZoomEvent(t,e)}),o.options.map.zoom.enabled&&o.initZoom(o.mapConf.width,o.mapConf.height,o.options.map.zoom),o.options.map.zoom.init!==a&&(o.options.map.zoom.init.animDuration===a&&(o.options.map.zoom.init.animDuration=0),o.$container.trigger("zoom",o.options.map.zoom.init)),o.createLegends("area",o.areas,1),o.createLegends("plot",o.plots,o.paper.width/o.mapConf.width),o.$container.on("update.mapael",function(t,e){o.onUpdateEvent(t,e)}),o.$container.on("showElementsInRange.mapael",function(t,e){o.onShowElementsInRange(t,e)}),o.initDelegatedMapEvents(),o.initDelegatedCustomEvents(),o.options.map.afterInit&&o.options.map.afterInit(o.$container,o.paper,o.areas,o.plots,o.options),t(o.paper.desc).append(" and Mapael "+o.version+" (https://www.vincentbroute.fr/mapael/)")},destroy:function(){var e=this;e.$container.off(".mapael"),e.$map.off(".mapael"),e.onResizeEvent&&t(window).off("resize.mapael",e.onResizeEvent),e.$map.empty(),e.$map.html(e.initialMapHTMLContent),t.each(e.legends,function(o){t.each(e.legends[o],function(t){var a=e.legends[o][t];a.container.empty(),a.container.html(a.initialHTMLContent)})}),e.$container.removeClass("mapael"),e.$container.removeData("mapael"),e.container=a,e.$container=a,e.options=a,e.paper=a,e.$map=a,e.$tooltip=a,e.mapConf=a,e.areas=a,e.plots=a,e.links=a,e.customEventHandlers=a},initResponsiveSize:function(){var e=this,o=null,a=function(t){var o=e.$map.width();if(e.paper.width!==o){var a=o/e.mapConf.width;e.paper.setSize(o,e.mapConf.height*a),!0!==t&&e.options.legend.redrawOnResize&&e.createLegends("plot",e.plots,a)}};e.onResizeEvent=function(){clearTimeout(o),o=setTimeout(function(){a()},e.resizeFilteringTO)},t(window).on("resize.mapael",e.onResizeEvent),a(!0)},extendDefaultOptions:function(e){return e=t.extend(!0,{},i.prototype.defaultOptions,e),t.each(["area","plot"],function(o,a){if(t.isArray(e.legend[a]))for(var n=0;n<e.legend[a].length;++n)e.legend[a][n]=t.extend(!0,{},i.prototype.legendDefaultOptions[a],e.legend[a][n]);else e.legend[a]=t.extend(!0,{},i.prototype.legendDefaultOptions[a],e.legend[a])}),e},initDelegatedMapEvents:function(){var e,o=this,i={area:o.areas,"area-text":o.areas,plot:o.plots,"plot-text":o.plots,link:o.links,"link-text":o.links};o.$container.on("mouseover.mapael","[data-id]",function(){var n=this;clearTimeout(e),e=setTimeout(function(){var e=t(n),s=e.attr("data-id"),r=e.attr("data-type");if(i[r]!==a)o.elemEnter(i[r][s]);else if("legend-elem"===r||"legend-label"===r){var p=e.attr("data-legend-id"),l=e.attr("data-legend-type");o.elemEnter(o.legends[l][p].elems[s])}},o.MouseOverFilteringTO)});var n;o.$container.on("mousemove.mapael","[data-id]",function(e){var s=this;clearTimeout(n),n=setTimeout(function(){var n=t(s),r=n.attr("data-id"),p=n.attr("data-type");i[p]!==a&&o.elemHover(i[p][r],e)},0)}),o.$container.on("mouseout.mapael","[data-id]",function(){clearTimeout(e),clearTimeout(n);var s=t(this),r=s.attr("data-id"),p=s.attr("data-type");if(i[p]!==a)o.elemOut(i[p][r]);else if("legend-elem"===p||"legend-label"===p){var l=s.attr("data-legend-id"),m=s.attr("data-legend-type");o.elemOut(o.legends[m][l].elems[r])}}),o.$container.on("click.mapael","[data-id]",function(e,n){var s=t(this),r=s.attr("data-id"),p=s.attr("data-type");if(i[p]!==a)o.elemClick(i[p][r]);else if("legend-elem"===p||"legend-label"===p){var l=s.attr("data-legend-id"),m=s.attr("data-legend-type");o.handleClickOnLegendElem(o.legends[m][l].elems[r],r,l,m,n)}})},initDelegatedCustomEvents:function(){var e=this;t.each(e.customEventHandlers,function(o){var i=o+".mapael.custom";e.$container.off(i).on(i,"[data-id]",function(i){var n=t(this),s=n.attr("data-id"),r=n.attr("data-type").replace("-text","");if(!e.panning&&e.customEventHandlers[o][r]!==a&&e.customEventHandlers[o][r][s]!==a){var p=e.customEventHandlers[o][r][s];p.options.eventHandlers[o](i,s,p.mapElem,p.textElem,p.options)}})})},initElem:function(e,o,i){var n=t(i.mapElem.node);if(i.options.href&&(i.options.attrs.cursor="pointer",i.options.text&&(i.options.text.attrs.cursor="pointer")),i.mapElem.attr(i.options.attrs),n.attr({"data-id":e,"data-type":o}),i.options.cssClass!==a&&n.addClass(i.options.cssClass),i.options.text&&i.options.text.content!==a){var s=this.getTextPosition(i.mapElem.getBBox(),i.options.text.position,i.options.text.margin);i.options.text.attrs.text=i.options.text.content,i.options.text.attrs.x=s.x,i.options.text.attrs.y=s.y,i.options.text.attrs["text-anchor"]=s.textAnchor,i.textElem=this.paper.text(s.x,s.y,i.options.text.content),i.textElem.attr(i.options.text.attrs),t(i.textElem.node).attr({"data-id":e,"data-type":o+"-text"})}i.options.eventHandlers&&this.setEventHandlers(e,o,i),this.setHoverOptions(i.mapElem,i.options.attrs,i.options.attrsHover),i.textElem&&this.setHoverOptions(i.textElem,i.options.text.attrs,i.options.text.attrsHover)},initZoom:function(e,o,i){var n=this,s=!1,r=0,p=0,l={reset:function(){n.$container.trigger("zoom",{level:0})},in:function(){n.$container.trigger("zoom",{level:"+1"})},out:function(){n.$container.trigger("zoom",{level:-1})}};t.extend(n.zoomData,{zoomLevel:0,panX:0,panY:0}),t.each(i.buttons,function(e,o){if(l[e]===a)throw new Error("Unknown zoom button '"+e+"'");var i=t("<div>").addClass(o.cssClass).html(o.content).attr("title",o.title);i.on("click.mapael",l[e]),n.$map.append(i)}),n.options.map.zoom.mousewheel&&n.$map.on("mousewheel.mapael",function(t){var e=t.deltaY>0?1:-1,o=n.mapPagePositionToXY(t.pageX,t.pageY);n.$container.trigger("zoom",{fixedCenter:!0,level:n.zoomData.zoomLevel+e,x:o.x,y:o.y}),t.preventDefault()}),n.options.map.zoom.touch&&(n.$map.on("touchstart.mapael",function(t){2===t.originalEvent.touches.length&&(n.zoomCenterX=(t.originalEvent.touches[0].pageX+t.originalEvent.touches[1].pageX)/2,n.zoomCenterY=(t.originalEvent.touches[0].pageY+t.originalEvent.touches[1].pageY)/2,n.previousPinchDist=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)))}),n.$map.on("touchmove.mapael",function(t){var e=0,o=0;if(2===t.originalEvent.touches.length){if(e=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)),Math.abs(e-n.previousPinchDist)>15){var a=n.mapPagePositionToXY(n.zoomCenterX,n.zoomCenterY);o=(e-n.previousPinchDist)/Math.abs(e-n.previousPinchDist),n.$container.trigger("zoom",{fixedCenter:!0,level:n.zoomData.zoomLevel+o,x:a.x,y:a.y}),n.previousPinchDist=e}return!1}})),n.$map.on("dragstart",function(){return!1});var m=null,h=null;t("body").on("mouseup.mapael"+(i.touch?" touchend.mapael":""),function(){s=!1,clearTimeout(m),clearTimeout(h),m=setTimeout(function(){n.panning=!1},n.panningEndFilteringTO)}),n.$map.on("mousedown.mapael"+(i.touch?" touchstart.mapael":""),function(t){clearTimeout(m),clearTimeout(h),t.pageX!==a?(s=!0,r=t.pageX,p=t.pageY):1===t.originalEvent.touches.length&&(s=!0,r=t.originalEvent.touches[0].pageX,p=t.originalEvent.touches[0].pageY)}).on("mousemove.mapael"+(i.touch?" touchmove.mapael":""),function(l){var c=n.zoomData.zoomLevel,d=0,f=0;if(clearTimeout(m),clearTimeout(h),l.pageX!==a?(d=l.pageX,f=l.pageY):1===l.originalEvent.touches.length?(d=l.originalEvent.touches[0].pageX,f=l.originalEvent.touches[0].pageY):s=!1,s&&0!==c){var g=(r-d)/(1+c*i.step)*(e/n.paper.width),u=(p-f)/(1+c*i.step)*(o/n.paper.height),x=Math.min(Math.max(0,n.currentViewBox.x+g),e-n.currentViewBox.w),w=Math.min(Math.max(0,n.currentViewBox.y+u),o-n.currentViewBox.h);return(Math.abs(g)>5||Math.abs(u)>5)&&(t.extend(n.zoomData,{panX:x,panY:w,zoomX:x+n.currentViewBox.w/2,zoomY:w+n.currentViewBox.h/2}),n.setViewBox(x,w,n.currentViewBox.w,n.currentViewBox.h),h=setTimeout(function(){n.$map.trigger("afterPanning",{x1:x,y1:w,x2:x+n.currentViewBox.w,y2:w+n.currentViewBox.h})},n.panningFilteringTO),r=d,p=f,n.panning=!0),!1}})},mapPagePositionToXY:function(t,e){var o=this.$map.offset(),a=this.options.map.width?this.mapConf.width/this.options.map.width:this.mapConf.width/this.$map.width(),i=1/(1+this.zoomData.zoomLevel*this.options.map.zoom.step);return{x:i*a*(t-o.left)+this.zoomData.panX,y:i*a*(e-o.top)+this.zoomData.panY}},onZoomEvent:function(e,o){var i,n,s,r,p,l=this,m=l.zoomData.zoomLevel,h=1+l.zoomData.zoomLevel*l.options.map.zoom.step,c=o.animDuration!==a?o.animDuration:l.options.map.zoom.animDuration;if(o.area!==a){if(l.areas[o.area]===a)throw new Error("Unknown area '"+o.area+"'");var d=o.areaMargin!==a?o.areaMargin:10,f=l.areas[o.area].mapElem.getBBox(),g=f.width+2*d,u=f.height+2*d;o.x=f.cx,o.y=f.cy,m=Math.min(Math.floor((l.mapConf.width/g-1)/l.options.map.zoom.step),Math.floor((l.mapConf.height/u-1)/l.options.map.zoom.step))}else if(o.level!==a&&(m="string"==typeof o.level?"+"===o.level.slice(0,1)||"-"===o.level.slice(0,1)?l.zoomData.zoomLevel+parseInt(o.level,10):parseInt(o.level,10):o.level<0?l.zoomData.zoomLevel+o.level:o.level),o.plot!==a){if(l.plots[o.plot]===a)throw new Error("Unknown plot '"+o.plot+"'");o.x=l.plots[o.plot].coords.x,o.y=l.plots[o.plot].coords.y}else{if(o.latitude!==a&&o.longitude!==a){var x=l.mapConf.getCoords(o.latitude,o.longitude);o.x=x.x,o.y=x.y}o.x===a&&(o.x=l.currentViewBox.x+l.currentViewBox.w/2),o.y===a&&(o.y=l.currentViewBox.y+l.currentViewBox.h/2)}p=1+(m=Math.min(Math.max(m,l.options.map.zoom.minLevel),l.options.map.zoom.maxLevel))*l.options.map.zoom.step,s=l.mapConf.width/p,r=l.mapConf.height/p,0===m?(i=0,n=0):(o.fixedCenter!==a&&!0===o.fixedCenter?(i=l.zoomData.panX+(o.x-l.zoomData.panX)*(p-h)/p,n=l.zoomData.panY+(o.y-l.zoomData.panY)*(p-h)/p):(i=o.x-s/2,n=o.y-r/2),i=Math.min(Math.max(0,i),l.mapConf.width-s),n=Math.min(Math.max(0,n),l.mapConf.height-r)),p===h&&i===l.zoomData.panX&&n===l.zoomData.panY||(c>0?l.animateViewBox(i,n,s,r,c,l.options.map.zoom.animEasing):(l.setViewBox(i,n,s,r),clearTimeout(l.zoomTO),l.zoomTO=setTimeout(function(){l.$map.trigger("afterZoom",{x1:i,y1:n,x2:i+s,y2:n+r})},l.zoomFilteringTO)),t.extend(l.zoomData,{zoomLevel:m,panX:i,panY:n,zoomX:i+s/2,zoomY:n+r/2}))},onShowElementsInRange:function(t,e){e.animDuration===a&&(e.animDuration=0),e.hiddenOpacity===a&&(e.hiddenOpacity=.3),e.ranges&&e.ranges.area&&this.showElemByRange(e.ranges.area,this.areas,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.plot&&this.showElemByRange(e.ranges.plot,this.plots,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.link&&this.showElemByRange(e.ranges.link,this.links,e.hiddenOpacity,e.animDuration),e.afterShowRange&&e.afterShowRange()},showElemByRange:function(e,o,i,n){var s=this,r={};e.min===a&&e.max===a||(e={0:e}),t.each(e,function(n){var s=e[n];if(s.min===a&&s.max===a)return!0;t.each(o,function(t){var e=o[t].options.value;if("object"!=typeof e&&(e=[e]),e[n]===a)return!0;s.min!==a&&e[n]<s.min||s.max!==a&&e[n]>s.max?r[t]=i:r[t]=1})}),t.each(r,function(t){s.setElementOpacity(o[t],r[t],n)})},setElementOpacity:function(t,e,o){e>0&&(t.mapElem.show(),t.textElem&&t.textElem.show()),this.animate(t.mapElem,{opacity:e},o,function(){0===e&&t.mapElem.hide()}),this.animate(t.textElem,{opacity:e},o,function(){0===e&&t.textElem.hide()})},onUpdateEvent:function(e,o){var i=this;if("object"==typeof o){var n=0,s=o.animDuration?o.animDuration:0,r=function(t){i.animate(t.mapElem,{opacity:0},s,function(){t.mapElem.remove()}),i.animate(t.textElem,{opacity:0},s,function(){t.textElem.remove()})},p=function(t){t.mapElem.attr({opacity:0}),t.textElem&&t.textElem.attr({opacity:0}),i.setElementOpacity(t,t.mapElem.originalAttrs.opacity!==a?t.mapElem.originalAttrs.opacity:1,s)};if("object"==typeof o.mapOptions&&(!0===o.replaceOptions?i.options=i.extendDefaultOptions(o.mapOptions):t.extend(!0,i.options,o.mapOptions),o.mapOptions.areas===a&&o.mapOptions.plots===a&&o.mapOptions.legend===a||t("[data-type='legend-elem']",i.$container).each(function(e,o){"1"===t(o).attr("data-hidden")&&t(o).trigger("click",{hideOtherElems:!1,animDuration:s})})),"object"==typeof o.deletePlotKeys)for(;n<o.deletePlotKeys.length;n++)i.plots[o.deletePlotKeys[n]]!==a&&(r(i.plots[o.deletePlotKeys[n]]),delete i.plots[o.deletePlotKeys[n]]);else"all"===o.deletePlotKeys&&(t.each(i.plots,function(t,e){r(e)}),i.plots={});if("object"==typeof o.deleteLinkKeys)for(n=0;n<o.deleteLinkKeys.length;n++)i.links[o.deleteLinkKeys[n]]!==a&&(r(i.links[o.deleteLinkKeys[n]]),delete i.links[o.deleteLinkKeys[n]]);else"all"===o.deleteLinkKeys&&(t.each(i.links,function(t,e){r(e)}),i.links={});if("object"==typeof o.newPlots&&t.each(o.newPlots,function(t){i.plots[t]===a&&(i.options.plots[t]=o.newPlots[t],i.plots[t]=i.drawPlot(t),s>0&&p(i.plots[t]))}),"object"==typeof o.newLinks){var l=i.drawLinksCollection(o.newLinks);t.extend(i.links,l),t.extend(i.options.links,o.newLinks),s>0&&t.each(l,function(t){p(l[t])})}if(t.each(i.areas,function(t){("object"==typeof o.mapOptions&&("object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultArea||"object"==typeof o.mapOptions.areas&&"object"==typeof o.mapOptions.areas[t]||"object"==typeof o.mapOptions.legend&&"object"==typeof o.mapOptions.legend.area)||!0===o.replaceOptions)&&(i.areas[t].options=i.getElemOptions(i.options.map.defaultArea,i.options.areas[t]?i.options.areas[t]:{},i.options.legend.area),i.updateElem(i.areas[t],s))}),t.each(i.plots,function(t){("object"==typeof o.mapOptions&&("object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultPlot||"object"==typeof o.mapOptions.plots&&"object"==typeof o.mapOptions.plots[t]||"object"==typeof o.mapOptions.legend&&"object"==typeof o.mapOptions.legend.plot)||!0===o.replaceOptions)&&(i.plots[t].options=i.getElemOptions(i.options.map.defaultPlot,i.options.plots[t]?i.options.plots[t]:{},i.options.legend.plot),i.setPlotCoords(i.plots[t]),i.setPlotAttributes(i.plots[t]),i.updateElem(i.plots[t],s))}),t.each(i.links,function(t){("object"==typeof o.mapOptions&&("object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultLink||"object"==typeof o.mapOptions.links&&"object"==typeof o.mapOptions.links[t])||!0===o.replaceOptions)&&(i.links[t].options=i.getElemOptions(i.options.map.defaultLink,i.options.links[t]?i.options.links[t]:{},{}),i.updateElem(i.links[t],s))}),o.mapOptions&&("object"==typeof o.mapOptions.legend||"object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultArea||"object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultPlot)&&(t("[data-type='legend-elem']",i.$container).each(function(e,o){"1"===t(o).attr("data-hidden")&&t(o).trigger("click",{hideOtherElems:!1,animDuration:s})}),i.createLegends("area",i.areas,1),i.options.map.width?i.createLegends("plot",i.plots,i.options.map.width/i.mapConf.width):i.createLegends("plot",i.plots,i.$map.width()/i.mapConf.width)),"object"==typeof o.setLegendElemsState)t.each(o.setLegendElemsState,function(e,o){var n=i.$container.find("."+e)[0];n!==a&&t("[data-type='legend-elem']",n).each(function(e,a){("0"===t(a).attr("data-hidden")&&"hide"===o||"1"===t(a).attr("data-hidden")&&"show"===o)&&t(a).trigger("click",{hideOtherElems:!1,animDuration:s})})});else{var m="hide"===o.setLegendElemsState?"hide":"show";t("[data-type='legend-elem']",i.$container).each(function(e,o){("0"===t(o).attr("data-hidden")&&"hide"===m||"1"===t(o).attr("data-hidden")&&"show"===m)&&t(o).trigger("click",{hideOtherElems:!1,animDuration:s})})}i.initDelegatedCustomEvents(),o.afterUpdate&&o.afterUpdate(i.$container,i.paper,i.areas,i.plots,i.options,i.links)}},setPlotCoords:function(t){if(t.options.x!==a&&t.options.y!==a)t.coords={x:t.options.x,y:t.options.y};else if(t.options.plotsOn!==a&&this.areas[t.options.plotsOn]!==a){var e=this.areas[t.options.plotsOn].mapElem.getBBox();t.coords={x:e.cx,y:e.cy}}else t.coords=this.mapConf.getCoords(t.options.latitude,t.options.longitude)},setPlotAttributes:function(t){"square"===t.options.type?(t.options.attrs.width=t.options.size,t.options.attrs.height=t.options.size,t.options.attrs.x=t.coords.x-t.options.size/2,t.options.attrs.y=t.coords.y-t.options.size/2):"image"===t.options.type?(t.options.attrs.src=t.options.url,t.options.attrs.width=t.options.width,t.options.attrs.height=t.options.height,t.options.attrs.x=t.coords.x-t.options.width/2,t.options.attrs.y=t.coords.y-t.options.height/2):"svg"===t.options.type?(t.options.attrs.path=t.options.path,t.options.attrs.transform===a&&(t.options.attrs.transform=""),t.mapElem.originalBBox===a&&(t.mapElem.originalBBox=t.mapElem.getBBox()),t.mapElem.baseTransform="m"+t.options.width/t.mapElem.originalBBox.width+",0,0,"+t.options.height/t.mapElem.originalBBox.height+","+(t.coords.x-t.options.width/2)+","+(t.coords.y-t.options.height/2),t.options.attrs.transform=t.mapElem.baseTransform+t.options.attrs.transform):(t.options.attrs.x=t.coords.x,t.options.attrs.y=t.coords.y,t.options.attrs.r=t.options.size/2)},drawLinksCollection:function(e){var o=this,i={},n={},s={},r={},p={};return t.each(e,function(t){var l=o.getElemOptions(o.options.map.defaultLink,e[t],{});if(i="string"==typeof e[t].between[0]?o.options.plots[e[t].between[0]]:e[t].between[0],n="string"==typeof e[t].between[1]?o.options.plots[e[t].between[1]]:e[t].between[1],i.plotsOn!==a&&o.areas[i.plotsOn]!==a){var m=o.areas[i.plotsOn].mapElem.getBBox();s={x:m.cx,y:m.cy}}else i.latitude!==a&&i.longitude!==a?s=o.mapConf.getCoords(i.latitude,i.longitude):(s.x=i.x,s.y=i.y);if(n.plotsOn!==a&&o.areas[n.plotsOn]!==a){var h=o.areas[n.plotsOn].mapElem.getBBox();r={x:h.cx,y:h.cy}}else n.latitude!==a&&n.longitude!==a?r=o.mapConf.getCoords(n.latitude,n.longitude):(r.x=n.x,r.y=n.y);p[t]=o.drawLink(t,s.x,s.y,r.x,r.y,l)}),p},drawLink:function(t,e,o,a,i,n){var s={options:n},r=(e+a)/2,p=(o+i)/2,l=-1/((i-o)/(a-e)),m=p-l*r,h=Math.sqrt((a-e)*(a-e)+(i-o)*(i-o)),c=1+l*l,d=-2*r+2*l*m-2*l*p,f=d*d-4*c*(r*r+m*m-m*p-p*m+p*p-n.factor*h*(n.factor*h)),g=0,u=0;return u=n.factor>0?l*(g=(-d+Math.sqrt(f))/(2*c))+m:l*(g=(-d-Math.sqrt(f))/(2*c))+m,s.mapElem=this.paper.path("m "+e+","+o+" C "+g+","+u+" "+a+","+i+" "+a+","+i),this.initElem(t,"link",s),s},isAttrsChanged:function(t,e){for(var o in e)if(e.hasOwnProperty(o)&&void 0===t[o]||e[o]!==t[o])return!0;return!1},updateElem:function(e,o){var i,n,s;if(!0===e.options.toFront&&e.mapElem.toFront(),e.options.href!==a?(e.options.attrs.cursor="pointer",e.options.text&&(e.options.text.attrs.cursor="pointer")):"pointer"===e.mapElem.attrs.cursor&&(e.options.attrs.cursor="auto",e.options.text&&(e.options.text.attrs.cursor="auto")),e.textElem){e.options.text.attrs.text=e.options.text.content,i=e.mapElem.getBBox(),(e.options.size||e.options.width&&e.options.height)&&("image"===e.options.type||"svg"===e.options.type?(n=(e.options.width-i.width)/2,s=(e.options.height-i.height)/2):(n=(e.options.size-i.width)/2,s=(e.options.size-i.height)/2),i.x-=n,i.x2+=n,i.y-=s,i.y2+=s);var r=this.getTextPosition(i,e.options.text.position,e.options.text.margin);e.options.text.attrs.x=r.x,e.options.text.attrs.y=r.y,e.options.text.attrs["text-anchor"]=r.textAnchor,this.setHoverOptions(e.textElem,e.options.text.attrs,e.options.text.attrsHover),this.isAttrsChanged(e.textElem.attrs,e.options.text.attrs)&&this.animate(e.textElem,e.options.text.attrs,o)}this.setHoverOptions(e.mapElem,e.options.attrs,e.options.attrsHover),this.isAttrsChanged(e.mapElem.attrs,e.options.attrs)&&this.animate(e.mapElem,e.options.attrs,o),e.options.cssClass!==a&&t(e.mapElem.node).removeClass().addClass(e.options.cssClass)},drawPlot:function(t){var e={};return e.options=this.getElemOptions(this.options.map.defaultPlot,this.options.plots[t]?this.options.plots[t]:{},this.options.legend.plot),this.setPlotCoords(e),"svg"===e.options.type&&(e.mapElem=this.paper.path(e.options.path)),this.setPlotAttributes(e),"square"===e.options.type?e.mapElem=this.paper.rect(e.options.attrs.x,e.options.attrs.y,e.options.attrs.width,e.options.attrs.height):"image"===e.options.type?e.mapElem=this.paper.image(e.options.attrs.src,e.options.attrs.x,e.options.attrs.y,e.options.attrs.width,e.options.attrs.height):"svg"===e.options.type||(e.mapElem=this.paper.circle(e.options.attrs.x,e.options.attrs.y,e.options.attrs.r)),this.initElem(t,"plot",e),e},setEventHandlers:function(e,o,i){var n=this;t.each(i.options.eventHandlers,function(t){n.customEventHandlers[t]===a&&(n.customEventHandlers[t]={}),n.customEventHandlers[t][o]===a&&(n.customEventHandlers[t][o]={}),n.customEventHandlers[t][o][e]=i})},drawLegend:function(o,i,n,s,r){var p={},l={},m=0,h=0,c=null,d=null,f={},g=0,u=0,x=0,w=0,v=[],y=(p=t("."+o.cssClass,this.$container)).html();for(p.empty(),l=new e(p.get(0)),t(l.canvas).attr({"data-legend-type":i,"data-legend-id":r}),h=m=0,o.title&&""!==o.title&&(d=(c=l.text(o.marginLeftTitle,0,o.title).attr(o.titleAttrs)).getBBox(),c.attr({y:.5*d.height}),m=o.marginLeftTitle+d.width,h+=o.marginBottomTitle+d.height),g=0;g<o.slices.length;++g){var E=0;v[g]=t.extend(!0,{},"plot"===i?this.options.map.defaultPlot:this.options.map.defaultArea,o.slices[g]),o.slices[g].legendSpecificAttrs===a&&(o.slices[g].legendSpecificAttrs={}),t.extend(!0,v[g].attrs,o.slices[g].legendSpecificAttrs),"area"===i?(v[g].attrs.width===a&&(v[g].attrs.width=30),v[g].attrs.height===a&&(v[g].attrs.height=20)):"square"===v[g].type?(v[g].attrs.width===a&&(v[g].attrs.width=v[g].size),v[g].attrs.height===a&&(v[g].attrs.height=v[g].size)):"image"===v[g].type||"svg"===v[g].type?(v[g].attrs.width===a&&(v[g].attrs.width=v[g].width),v[g].attrs.height===a&&(v[g].attrs.height=v[g].height)):v[g].attrs.r===a&&(v[g].attrs.r=v[g].size/2),E=o.marginBottomTitle,c&&(E+=d.height),"plot"!==i||v[g].type!==a&&"circle"!==v[g].type?E+=s*v[g].attrs.height/2:E+=s*v[g].attrs.r,w=Math.max(w,E)}for("horizontal"===o.mode&&(m=o.marginLeft),g=0;g<v.length;++g){var z={},C={},O={};if(v[g].display===a||!0===v[g].display){if("area"===i?("horizontal"===o.mode?(u=m+o.marginLeft,x=w-.5*s*v[g].attrs.height):(u=o.marginLeft,x=h),z=l.rect(u,x,s*v[g].attrs.width,s*v[g].attrs.height)):"square"===v[g].type?("horizontal"===o.mode?(u=m+o.marginLeft,x=w-.5*s*v[g].attrs.height):(u=o.marginLeft,x=h),z=l.rect(u,x,s*v[g].attrs.width,s*v[g].attrs.height)):"image"===v[g].type||"svg"===v[g].type?("horizontal"===o.mode?(u=m+o.marginLeft,x=w-.5*s*v[g].attrs.height):(u=o.marginLeft,x=h),"image"===v[g].type?z=l.image(v[g].url,u,x,s*v[g].attrs.width,s*v[g].attrs.height):(z=l.path(v[g].path),v[g].attrs.transform===a&&(v[g].attrs.transform=""),C=z.getBBox(),v[g].attrs.transform="m"+s*v[g].width/C.width+",0,0,"+s*v[g].height/C.height+","+u+","+x+v[g].attrs.transform)):("horizontal"===o.mode?(u=m+o.marginLeft+s*v[g].attrs.r,x=w):(u=o.marginLeft+s*v[g].attrs.r,x=h+s*v[g].attrs.r),z=l.circle(u,x,s*v[g].attrs.r)),delete v[g].attrs.width,delete v[g].attrs.height,delete v[g].attrs.r,z.attr(v[g].attrs),C=z.getBBox(),"horizontal"===o.mode?(u=m+o.marginLeft+C.width+o.marginLeftLabel,x=w):(u=o.marginLeft+C.width+o.marginLeftLabel,x=h+C.height/2),O=l.text(u,x,v[g].label).attr(o.labelAttrs),"horizontal"===o.mode){var B=o.marginBottom+C.height;m+=o.marginLeft+C.width+o.marginLeftLabel+O.getBBox().width,"image"!==v[g].type&&"area"!==i&&(B+=o.marginBottomTitle),c&&(B+=d.height),h=Math.max(h,B)}else m=Math.max(m,o.marginLeft+C.width+o.marginLeftLabel+O.getBBox().width),h+=o.marginBottom+C.height;t(z.node).attr({"data-legend-id":r,"data-legend-type":i,"data-type":"legend-elem","data-id":g,"data-hidden":0}),t(O.node).attr({"data-legend-id":r,"data-legend-type":i,"data-type":"legend-label","data-id":g,"data-hidden":0}),f[g]={mapElem:z,textElem:O},o.hideElemsOnClick.enabled&&(O.attr({cursor:"pointer"}),z.attr({cursor:"pointer"}),this.setHoverOptions(z,v[g].attrs,v[g].attrs),this.setHoverOptions(O,o.labelAttrs,o.labelAttrsHover),v[g].clicked!==a&&!0===v[g].clicked&&this.handleClickOnLegendElem(f[g],g,r,i,{hideOtherElems:!1}))}}return"SVG"!==e.type&&o.VMLWidth&&(m=o.VMLWidth),l.setSize(m,h),{container:p,initialHTMLContent:y,elems:f}},handleClickOnLegendElem:function(e,o,i,n,s){var r,p=this;s=s||{},r=t.isArray(p.options.legend[n])?p.options.legend[n][i]:p.options.legend[n];var l=e.mapElem,m=e.textElem,h=t(l.node),c=t(m.node),d=r.slices[o],f="area"===n?p.areas:p.plots,g=s.animDuration!==a?s.animDuration:r.hideElemsOnClick.animDuration,u=h.attr("data-hidden"),x="0"===u?{"data-hidden":"1"}:{"data-hidden":"0"};"0"===u?p.animate(m,{opacity:.5},g):p.animate(m,{opacity:1},g),t.each(f,function(e){var o,n=f[e].mapElem.data("hidden-by");n===a&&(n={}),o=t.isArray(f[e].options.value)?f[e].options.value[i]:f[e].options.value,p.getLegendSlice(o,r)===d&&("0"===u?(n[i]=!0,p.setElementOpacity(f[e],r.hideElemsOnClick.opacity,g)):(delete n[i],t.isEmptyObject(n)&&p.setElementOpacity(f[e],f[e].mapElem.originalAttrs.opacity!==a?f[e].mapElem.originalAttrs.opacity:1,g)),f[e].mapElem.data("hidden-by",n))}),h.attr(x),c.attr(x),s.hideOtherElems!==a&&!0!==s.hideOtherElems||!0!==r.exclusive||t("[data-type='legend-elem'][data-hidden=0]",p.$container).each(function(){var e=t(this);e.attr("data-id")!==o&&e.trigger("click",{hideOtherElems:!1})})},createLegends:function(e,o,a){var i=this.options.legend[e];t.isArray(this.options.legend[e])||(i=[this.options.legend[e]]),this.legends[e]={};for(var n=0;n<i.length;++n)!0===i[n].display&&t.isArray(i[n].slices)&&i[n].slices.length>0&&""!==i[n].cssClass&&0!==t("."+i[n].cssClass,this.$container).length&&(this.legends[e][n]=this.drawLegend(i[n],e,o,a,n))},setHoverOptions:function(o,a,i){"SVG"!==e.type&&delete i.transform,o.attrsHover=i,o.attrsHover.transform?o.originalAttrs=t.extend({transform:"s1"},a):o.originalAttrs=a},elemEnter:function(t){if(t!==a){if(t.mapElem!==a&&this.animate(t.mapElem,t.mapElem.attrsHover,t.mapElem.attrsHover.animDuration),t.textElem!==a&&this.animate(t.textElem,t.textElem.attrsHover,t.textElem.attrsHover.animDuration),t.options&&t.options.tooltip!==a){var e="";this.$tooltip.removeClass().addClass(this.options.map.tooltip.cssClass),t.options.tooltip.content!==a&&(e="function"==typeof t.options.tooltip.content?t.options.tooltip.content(t.mapElem):t.options.tooltip.content),t.options.tooltip.cssClass!==a&&this.$tooltip.addClass(t.options.tooltip.cssClass),this.$tooltip.html(e).css("display","block")}t.mapElem===a&&t.textElem===a||this.paper.safari&&this.paper.safari()}},elemHover:function(t,e){if(t!==a&&t.options.tooltip!==a){var o=e.pageX,i=e.pageY,n=10,s=20;"object"==typeof t.options.tooltip.offset&&(void 0!==t.options.tooltip.offset.left&&(n=t.options.tooltip.offset.left),void 0!==t.options.tooltip.offset.top&&(s=t.options.tooltip.offset.top));var r={left:Math.min(this.$map.width()-this.$tooltip.outerWidth()-5,o-this.$map.offset().left+n),top:Math.min(this.$map.height()-this.$tooltip.outerHeight()-5,i-this.$map.offset().top+s)};"object"==typeof t.options.tooltip.overflow&&(!0===t.options.tooltip.overflow.right&&(r.left=o-this.$map.offset().left+10),!0===t.options.tooltip.overflow.bottom&&(r.top=i-this.$map.offset().top+20)),this.$tooltip.css(r)}},elemOut:function(t){t!==a&&(t.mapElem!==a&&this.animate(t.mapElem,t.mapElem.originalAttrs,t.mapElem.attrsHover.animDuration),t.textElem!==a&&this.animate(t.textElem,t.textElem.originalAttrs,t.textElem.attrsHover.animDuration),t.options&&t.options.tooltip!==a&&this.$tooltip.css({display:"none",top:-1e3,left:-1e3}),t.mapElem===a&&t.textElem===a||this.paper.safari&&this.paper.safari())},elemClick:function(t){t!==a&&(this.panning||t.options.href===a||window.open(t.options.href,t.options.target))},getElemOptions:function(e,o,i){var n=t.extend(!0,{},e,o);if(n.value!==a)if(t.isArray(i))for(var s=0;s<i.length;++s)n=t.extend(!0,{},n,this.getLegendSlice(n.value[s],i[s]));else n=t.extend(!0,{},n,this.getLegendSlice(n.value,i));return n},getTextPosition:function(t,e,o){var a=0,i=0,n="";switch("number"==typeof o&&(o="bottom"===e||"top"===e?{x:0,y:o}:"right"===e||"left"===e?{x:o,y:0}:{x:0,y:0}),e){case"bottom":a=(t.x+t.x2)/2+o.x,i=t.y2+o.y,n="middle";break;case"top":a=(t.x+t.x2)/2+o.x,i=t.y-o.y,n="middle";break;case"left":a=t.x-o.x,i=(t.y+t.y2)/2+o.y,n="end";break;case"right":a=t.x2+o.x,i=(t.y+t.y2)/2+o.y,n="start";break;default:a=(t.x+t.x2)/2+o.x,i=(t.y+t.y2)/2+o.y,n="middle"}return{x:a,y:i,textAnchor:n}},getLegendSlice:function(t,e){for(var o=0;o<e.slices.length;++o)if(e.slices[o].sliceValue!==a&&t===e.slices[o].sliceValue||e.slices[o].sliceValue===a&&(e.slices[o].min===a||t>=e.slices[o].min)&&(e.slices[o].max===a||t<=e.slices[o].max))return e.slices[o];return{}},animateViewBox:function(t,o,a,i,n,s){var r=this,p=r.currentViewBox.x,l=t-p,m=r.currentViewBox.y,h=o-m,c=r.currentViewBox.w,d=a-c,f=r.currentViewBox.h,g=i-f;r.zoomAnimCVBTarget||(r.zoomAnimCVBTarget={x:t,y:o,w:a,h:i});var u=c>a?"in":"out",x=e.easing_formulas[s||"linear"],w=n-2*n/100,v=r.zoomAnimStartTime;r.zoomAnimStartTime=(new Date).getTime();var y=function(){r.cancelAnimationFrame(r.zoomAnimID);var e=(new Date).getTime()-r.zoomAnimStartTime;if(e<w){var s,E,z,C;if(v&&r.zoomAnimCVBTarget&&r.zoomAnimCVBTarget.w!==a){var O=(new Date).getTime()-v,B=x(O/n);s=p+(r.zoomAnimCVBTarget.x-p)*B,E=m+(r.zoomAnimCVBTarget.y-m)*B,z=c+(r.zoomAnimCVBTarget.w-c)*B,C=f+(r.zoomAnimCVBTarget.h-f)*B,l=t-(p=s),h=o-(m=E),d=a-(c=z),g=i-(f=C),r.zoomAnimCVBTarget={x:t,y:o,w:a,h:i}}else{var b=x(e/n);s=p+l*b,E=m+h*b,z=c+d*b,C=f+g*b}"in"===u&&(z>r.currentViewBox.w||z<a)||"out"===u&&(z<r.currentViewBox.w||z>a)||r.setViewBox(s,E,z,C),r.zoomAnimID=r.requestAnimationFrame(y)}else r.zoomAnimStartTime=null,r.zoomAnimCVBTarget=null,r.currentViewBox.w!==a&&r.setViewBox(t,o,a,i),r.$map.trigger("afterZoom",{x1:t,y1:o,x2:t+a,y2:o+i})};y()},requestAnimationFrame:function(t){return this._requestAnimationFrameFn.call(window,t)},cancelAnimationFrame:function(t){this._cancelAnimationFrameFn.call(window,t)},_requestAnimationFrameFn:function(){var t=function(){var e=(new Date).getTime();return function(o){var a=(new Date).getTime();if(!(a-e>16))return setTimeout(function(){t(o)},0);e=a,o(a)}}();return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||t}(),_cancelAnimationFrameFn:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||clearTimeout,setViewBox:function(t,e,o,a){this.currentViewBox.x=t,this.currentViewBox.y=e,this.currentViewBox.w=o,this.currentViewBox.h=a,this.paper.setViewBox(t,e,o,a,!1)},_nonAnimatedAttrs:["arrow-end","arrow-start","gradient","class","cursor","text-anchor","font","font-family","font-style","font-weight","letter-spacing","src","href","target","title","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit"],animate:function(t,e,o,i){if(t)if(o>0){for(var n={},s=0;s<this._nonAnimatedAttrs.length;s++){var r=this._nonAnimatedAttrs[s];e[r]!==a&&(n[r]=e[r])}t.attr(n),t.animate(e,o,"linear",function(){i&&i()})}else t.attr(e),i&&i()},isRaphaelBBoxBugPresent:function(){var t=this.paper.text(-50,-50,"TEST"),e=t.getBBox();return t.remove(),0===e.width&&0===e.height},defaultOptions:{map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"area"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"plot"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"link"},zoom:{enabled:!1,minLevel:0,maxLevel:10,step:.25,mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear",buttons:{reset:{cssClass:"zoomButton zoomReset",content:"&#8226;",title:"Reset zoom"},in:{cssClass:"zoomButton zoomIn",content:"+",title:"Zoom in"},out:{cssClass:"zoomButton zoomOut",content:"&#8722;",title:"Zoom out"}}}},legend:{redrawOnResize:!0,area:[],plot:[]},areas:{},plots:{},links:{}},legendDefaultOptions:{area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"}}},i.version="2.2.0",t.mapael===a&&(t.mapael=i),t.fn.mapael=function(e){return this.each(function(){t.data(this,"mapael")&&t.data(this,"mapael").destroy(),t.data(this,"mapael",new i(this,e))})},i});